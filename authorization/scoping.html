<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - Scoping</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <a href="/getting_started">Get Started</a>
          <a href="/guides">Guides</a>
          <a href="/api-doc/2.0.22/">API</a>
          <a href="https://tinyletter.com/graphql-ruby">Newsletter</a>
          <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
          <a href="https://graphql.pro">Upgrade to Pro</a>
          <input
            class="search-input"
            onkeyup="GraphQLRubySearch.run(this)"
            type="text"
            placeholder="Search the docs..."
          />
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  selected data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/authorization/overview.html">Overview</option>
      
        <option  data-target="/authorization/visibility.html">Visibility</option>
      
        <option  data-target="/authorization/authorization.html">Authorization</option>
      
        <option  data-target="/authorization/can_can_integration.html">CanCan Integration</option>
      
        <option  data-target="/authorization/pundit_integration.html">Pundit Integration</option>
      
        <option  selected data-target="/authorization/scoping.html">Scoping</option>
      
    </select>
  </li>
</ul>



<h1 class="guide-header">Scoping</h1>
<div class="guide-table-of-contents"><div class="table-of-contents">
  <h3 class="contents-header">Contents</h3>
  <ol class='contents-list'><li class='contents-entry'><a href='#scope-option'><code>scope:</code> option
</a></li><li class='contents-entry'><a href='#scope_items-items-ctx-method'><code>.scope_items(items, ctx)</code> method
</a></li></ol>
</div>
</div>
<div class="guide-container">
  <p><em>Scoping</em> is a complementary consideration to authorization. Rather than checking “can this user see this thing?”, scoping takes a list of items filters it to the subset which is appropriate for the current viewer and context. The resulting subset is authorized as normal, and, assuming that it was properly scoped, each item should pass authorization checks.</p>

<p>For similar features, see <a href="https://github.com/varvet/pundit#scopes">Pundit scopes</a> and <a href="https://github.com/cancancommunity/cancancan/wiki/Fetching-Records">Cancan’s <code class="language-plaintext highlighter-rouge">.accessible_by</code></a>.</p>

<h2 id="scope-option"><code class="language-plaintext highlighter-rouge">scope:</code> option</h2>

<p>Fields accept a <code class="language-plaintext highlighter-rouge">scope:</code> option to enable (or disable) scoping, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:products</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Product</span><span class="p">],</span> <span class="ss">scope: </span><span class="kp">true</span>
<span class="c1"># Or</span>
<span class="n">field</span> <span class="ss">:all_products</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Product</span><span class="p">],</span> <span class="ss">scope: </span><span class="kp">false</span>
</code></pre></div></div>

<p>For <strong>list</strong> and <strong>connection</strong> fields, <code class="language-plaintext highlighter-rouge">scope: true</code> is the default. For all other fields, <code class="language-plaintext highlighter-rouge">scope: false</code> is the default. You can override this by using the <code class="language-plaintext highlighter-rouge">scope:</code> option.</p>

<h2 id="scope_itemsitems-ctx-method"><code class="language-plaintext highlighter-rouge">.scope_items(items, ctx)</code> method</h2>

<p>Type classes may implement <code class="language-plaintext highlighter-rouge">.scope_items(items, ctx)</code>. This method is called when a field has <code class="language-plaintext highlighter-rouge">scope: true</code>. For example,</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:products</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Product</span><span class="p">]</span> <span class="c1"># has `scope: true` by default</span>
</code></pre></div></div>

<p>Will call:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Product</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">scope_items</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="c1"># filter items here</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The method should return a new list with only the appropriate items for the current <code class="language-plaintext highlighter-rouge">context</code>.</p>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/authorization/scoping.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Scoping">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
